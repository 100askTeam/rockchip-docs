<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Dshanpi-R1-Docs/part5/UartDrive" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">UART开发指南 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rockchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://rockchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://rockchip.100ask.net/en/docs/Dshanpi-R1-Docs/part5/UartDrive"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="UART开发指南 | 东山Π"><meta data-rh="true" name="description" content="1.功能特点"><meta data-rh="true" property="og:description" content="1.功能特点"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rockchip.100ask.net/en/docs/Dshanpi-R1-Docs/part5/UartDrive"><link data-rh="true" rel="alternate" href="https://rockchip.100ask.net/docs/Dshanpi-R1-Docs/part5/UartDrive" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://rockchip.100ask.net/en/docs/Dshanpi-R1-Docs/part5/UartDrive" hreflang="en"><link data-rh="true" rel="alternate" href="https://rockchip.100ask.net/docs/Dshanpi-R1-Docs/part5/UartDrive" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.e3ab61ce.css">
<script src="/en/assets/js/runtime~main.97661351.js" defer="defer"></script>
<script src="/en/assets/js/main.a871ebcf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">rockchip &gt;</b></a><a class="navbar__item navbar__link" href="/en/docs/Rockchip-SBC/">Rockchip SBC 介绍</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/Dshanpi-R1-Docs/BoardIntroduction">100ASK-RK3568 开发文档</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/Dshanpi-R1-Docs/part5/UartDrive" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/Dshanpi-R1-Docs/part5/UartDrive" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/rockchip-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/Dshanpi-R1-Docs/BoardIntroduction">100ASK RK3568</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/en/docs/category/构建系统镜像">构建系统镜像</a><button aria-label="Collapse sidebar category &#x27;构建系统镜像&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part1/BuildDevelopmentEnvironment">开发环境搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part1/GetSDK">获取SDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part1/CompileSDK">编译固件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/en/docs/category/开发板使用入门">开发板使用入门</a><button aria-label="Collapse sidebar category &#x27;开发板使用入门&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/UpdateSystem">更新系统固件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/StartDevelopmentBoard">启动开发板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/WiFiNetworking">WiFi联网</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/OTG">USB_OTG功能测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/TFCard">TF卡测试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/HeadphonePlayback">耳机播放功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part2/MIPIScreenDisplayTest">MIPI屏显示测试</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/en/docs/category/应用开发入门">应用开发入门</a><button aria-label="Collapse sidebar category &#x27;应用开发入门&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part3/HelloWorldFast">Hello快速入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part3/LVGLFast">移植V9.2-LVGL</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/en/docs/category/sdk开发">SDK开发</a><button aria-label="Collapse sidebar category &#x27;SDK开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/en/docs/category/linux419">linux4.19</a><button aria-label="Collapse sidebar category &#x27;linux4.19&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part4/part4-1/SDK">SDK开发指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" tabindex="0" href="/en/docs/category/linux510">linux5.10</a><button aria-label="Collapse sidebar category &#x27;linux5.10&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part4/part4-2/SDK">SDK开发指南</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/驱动开发入门">驱动开发入门</a><button aria-label="Collapse sidebar category &#x27;驱动开发入门&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/SpiDrive">SPI开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/UartDrive">UART开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/PwmDrive">PWM开发指 南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/CanDrive">Can开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/CanFdDrive">Can FD开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/PinctrlDrive">Pinctrl开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/Dshanpi-R1-Docs/part5/I2cDrive">I2C 开发指南</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/驱动开发入门"><span itemprop="name">驱动开发入门</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">UART开发指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>UART开发指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1功能特点">1.功能特点<a href="#1功能特点" class="hash-link" aria-label="Direct link to 1.功能特点" title="Direct link to 1.功能特点">​</a></h2>
<p>Rockchip UART (Universal Asynchronous Receiver/Transmitter) 基于 16550A 串口标准，完整模块支持以下功能:</p>
<ul>
<li>支持 5､6､7､8 bits 数据位｡</li>
<li>支持 1､1.5､2 bits 停止位｡</li>
<li>支持奇校验和偶校验，不支持 mark 校验和 space 校验｡</li>
<li>支持接收 FIFO 和发送 FIFO, 一般为 32 字节或者 64 字节｡</li>
<li>支持最高 4M 波特率，实际支持波特率需要芯片时钟分频策略配合｡</li>
<li>支持中断传输模式和 DMA 传输模式｡</li>
<li>支持硬件自动流控，RTS+CTS｡</li>
</ul>
<p>注意，实际芯片中的 UART 支持的功能请以芯片手册中 UART 章节的描述为准，部分 UART 功能会进行适当裁剪｡</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2作为普通串口">2.作为普通串口<a href="#2作为普通串口" class="hash-link" aria-label="Direct link to 2.作为普通串口" title="Direct link to 2.作为普通串口">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-驱动路径">2.1 驱动路径<a href="#21-驱动路径" class="hash-link" aria-label="Direct link to 2.1 驱动路径" title="Direct link to 2.1 驱动路径">​</a></h3>
<p>在 Linux kernel 3.10 中，使用以下驱动文件:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/rk_serial.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 Linux kernel 4.4 和 Linux kernel 4.19 中，使用 8250 串口通用驱动，以下为主要驱动文件:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/8250/8250_core.c # 8250 串口驱动核心</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/8250/8250_dw.c # Synopsis DesignWare 8250 串口驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/8250/8250_dma.c # 8250 串口 DMA 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/8250/8250_port.c # 8250 串口端口操作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/8250/8250_early.c # 8250 串口 early console 驱动</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-menuconfig-配置">2.2 menuconfig 配置<a href="#22-menuconfig-配置" class="hash-link" aria-label="Direct link to 2.2 menuconfig 配置" title="Direct link to 2.2 menuconfig 配置">​</a></h3>
<p>在不同版本的 Linux kernel 中，UART 相关的 menuconfig 配置均在以下路径选项，选项说明十分详细，这里不再展开:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	Character devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Serial drivers ---&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>建议使用 Rockchip SDK 中提供的 UART 默认配置｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-dts-配置">2.3 dts 配置<a href="#23-dts-配置" class="hash-link" aria-label="Direct link to 2.3 dts 配置" title="Direct link to 2.3 dts 配置">​</a></h3>
<p>在不同版本的 Linux kernel 中，UART 的 dts 配置均与以下典型配置类似｡以下典型配置以 Linux kernel 4.19 RK3568 芯片为例，在 rk3568.dtsi 中:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uart1: serial@fe650000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;rockchip,rk3568-uart&quot;, &quot;snps,dw-apb-uart&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg = &lt;0x0 0xfe650000 0x0 0x100&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupts = &lt;GIC_SPI 117 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clocks = &lt;&amp;cru SCLK_UART1&gt;, &lt;&amp;cru PCLK_UART1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-names = &quot;baudclk&quot;, &quot;apb_pclk&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg-shift = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg-io-width = &lt;4&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dmas = &lt;&amp;dmac0 2&gt;, &lt;&amp;dmac0 3&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma-names = &quot;tx&quot;, &quot;rx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;uart1m0_xfer&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;disabled&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>UART 的板级 dts 配置只有以下参数允许修改:</p>
<ul>
<li>
<p>dma-names:</p>
<ul>
<li>&quot;tx&quot; 打开 tx dma</li>
<li>&quot;rx&quot; 打开 rx dma</li>
<li>&quot;!tx&quot; 关闭 tx dma</li>
<li>&quot;!rx&quot; 关闭 rx dma</li>
</ul>
</li>
<li>
<p>pinctrl-0:</p>
<ul>
<li>&amp;uart1m0_xfer 配置 tx 和 rx 引脚为 iomux group 0</li>
<li>&amp;uart1m1_xfer 配置 tx 和 rx 引脚为 iomux group 1</li>
<li>&amp;uart1m0_ctsn 和 &amp; uart1m0_rtsn 配置硬件自动流控 cts 和 rts 引脚为 iomux group 0</li>
<li>&amp;uart1m1_ctsn 和 &amp; uart1m1_rtsn 配置硬件自动流控 cts 和 rts 引脚为 iomux group 1</li>
</ul>
</li>
<li>
<p>status:</p>
<ul>
<li>&quot;okay&quot; 打开</li>
<li>&quot;disabled&quot; 关闭</li>
</ul>
</li>
</ul>
<p>例如，打开 RK3568 UART1, 打开 dma, 配置打开了硬件自动流控的 UART1 的 tx、rx、cts、rts 的 iomux 为 group0, 在板级 dts 里的配置如下:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;uart1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma-names = &quot;tx&quot;, &quot;rx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;uart1m0_xfer &amp;uart1m0_ctsn &amp;uart1m0_rtsn&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要  注意，参数 pinctrl - 0 中对于硬件自动流控的操作仅仅是配置引脚 iomux, 实际使能硬件自动流控的操作在 UART 驱动中，如果不需要使用硬件自动流控，cts 和 rts 引脚的 iomux 配置可以去掉｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-波特率配置">2.4 波特率配置<a href="#24-波特率配置" class="hash-link" aria-label="Direct link to 2.4 波特率配置" title="Direct link to 2.4 波特率配置">​</a></h3>
<p>UART 波特率 = 工作时钟源 / 内部分频系数 / 16｡当工作时钟源由 24M 晶振直接提供时，UART 将使用内部分频系数得到需要的波特率｡当工作时钟源由 CRU 模块通过 PLL 分频提供时，UART 波特率一般为工作时钟源的 1/16｡UART 实际允许配置的波特率和此波特率下数据传输的稳定性在软件上主要由 UART 工作时钟分频策略决定｡</p>
<p>目前，UART 驱动会根据配置的波特率大小自动去获取需要的工作时钟频率，可以通过以下命令查询到 UART 工作时钟频率:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /sys/kernel/debug/clk/clk_summary | grep uart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Rockchip UART 对常用的波特率，如 115200､460800､921600､1500000､3000000､4000000 等确保稳定支持｡对于一些特殊的波特率，可能需要修改工作时钟分频策略才能支持｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="25-使用-dma">2.5 使用 DMA<a href="#25-使用-dma" class="hash-link" aria-label="Direct link to 2.5 使用 DMA" title="Direct link to 2.5 使用 DMA">​</a></h3>
<p>UART 使用 DMA 传输模式只有在数据量很大时才会产生较为明显的减轻 CPU 负载的效果｡一般情况下，和使用中断传输模式相比，UART 使用 DMA 传输模式并不一定能提高数据传输速度｡一方面，现在 CPU 性能都很高，传输瓶颈在外设｡另一方面，启动 DMA 需要消耗额外的资源，并且由于 UART 数据存在长度不确定的特性，会使 DMA 传输效率下降｡</p>
<p>因此，建议一般情况下使用默认中断传输模式，会有以下打印:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">failed to request DMA, use interrupt mode</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 DMA 通道资源紧张的使用场景下，可以考虑关掉 TX 的 DMA 传输，会有以下打印:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">got rx dma channels only</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="26-使用硬件自动流控">2.6 使用硬件自动流控<a href="#26-使用硬件自动流控" class="hash-link" aria-label="Direct link to 2.6 使用硬件自动流控" title="Direct link to 2.6 使用硬件自动流控">​</a></h3>
<p>UART 使用硬件自动流控时，需要确保 UART 驱动使能硬件自动流控功能，且在 dts 中已经切换 cts 和 rts 流控引脚的 iomux｡建议在高波特率 (1.5M 波特率及以上)､大数据量的场景下都使用硬件自动流控，即使用四线 UART｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="27-使用串口唤醒系统">2.7 使用串口唤醒系统<a href="#27-使用串口唤醒系统" class="hash-link" aria-label="Direct link to 2.7 使用串口唤醒系统" title="Direct link to 2.7 使用串口唤醒系统">​</a></h3>
<p>串口唤醒系统功能是在系统待机时串口保持打开，并且把串口中断设置为唤醒源｡使用时需要在 dts 中增加以下参数:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;uart1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wakeup-source;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意，串口唤醒系统需要同时修改 trust 固件，请联系 Rockchip 以获取支持｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="28-设备注册">2.8 设备注册<a href="#28-设备注册" class="hash-link" aria-label="Direct link to 2.8 设备注册" title="Direct link to 2.8 设备注册">​</a></h3>
<p>在 dts 中使能 UART 后，能在系统启动的 log 中看到以下对应的打印，表示设备正常注册:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fe650000.serial: ttyS1 at MMIO 0xfe650000 (irq = 67, base_baud = 1500000) is a 16550A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>普通串口设备将会根据 dts 中的 aliase 来对串口进行编号，对应注册成 ttySx 设备｡dts 中的 aliases 如下:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aliases {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial0 = &amp;uart0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial1 = &amp;uart1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial2 = &amp;uart2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial3 = &amp;uart3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要把 uart3 注册成 ttyS1, 可以进行以下修改:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aliases {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial0 = &amp;uart0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial1 = &amp;uart3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial2 = &amp;uart2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serial3 = &amp;uart1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3作为控制台">3.作为控制台<a href="#3作为控制台" class="hash-link" aria-label="Direct link to 3.作为控制台" title="Direct link to 3.作为控制台">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-驱动路径">3.1 驱动路径<a href="#31-驱动路径" class="hash-link" aria-label="Direct link to 3.1 驱动路径" title="Direct link to 3.1 驱动路径">​</a></h3>
<p>Rockchip UART 作为控制台，使用 fiq_debugger 流程｡Rockchip SDK 一般会将 uart2 配置为 ttyFIQ0 设备｡使用以下驱动文件:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">drivers/staging/android/fiq_debugger/fiq_debugger.c # 驱动文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/soc/rockchip/rk_fiq_debugger.c 				# kernel 4.4 及之后的平台实现</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arch/arm/mach-rockchip/rk_fiq_debugger.c 			# kernel 3.10 平台实现</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-menuconfig-配置">3.2 menuconfig 配置<a href="#32-menuconfig-配置" class="hash-link" aria-label="Direct link to 3.2 menuconfig 配置" title="Direct link to 3.2 menuconfig 配置">​</a></h3>
<p>在不同版本的 Linux kernel 中，fiq_debugger 相关的 menuconfig 配置均在以下路径选项:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	[*] Staging drivers ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		Android ---&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>建议使用 Rockchip SDK 默认配置｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-dts-配置">3.3 dts 配置<a href="#33-dts-配置" class="hash-link" aria-label="Direct link to 3.3 dts 配置" title="Direct link to 3.3 dts 配置">​</a></h3>
<p>以 Linux kernel 4.19 RK3568 为例，在 dts 中 fiq_debugger 节点配置如下｡由于 fiq_debugger 和普通串口互斥，在使能 fiq_debugger 节点后必须禁用对应的普通串口 uart 节点｡</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chosen: chosen {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bootargs = &quot;earlycon=uart8250,mmio32,0xfe660000 console=ttyFIQ0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fiq-debugger {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;rockchip,fiq-debugger&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rockchip,serial-id = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rockchip,wake-irq = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* If enable uart uses irq instead of fiq */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rockchip,irq-mode-enable = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rockchip,baudrate = &lt;1500000&gt;; /* Only 115200 and 1500000 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupts = &lt;GIC_SPI 252 IRQ_TYPE_LEVEL_LOW&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;uart2m0_xfer&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;uart2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;disabled&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以下对几个参数进行说明:</p>
<ul>
<li>rockchip,serial - id: 使用的 UART 编号｡修改 serial-id 到不同 UART,fiq_debugger 设备也会注册成 ttyFIQ0 设备｡</li>
<li>rockchip,irq-mode-enable: 配置为 1 使用 irq 中断，配置为 0 使用 fiq 中断｡</li>
<li>interrupts: 配置的辅助中断，保持默认即可｡</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-parametertxt-配 置">3.4 parameter.txt 配置<a href="#34-parametertxt-配置" class="hash-link" aria-label="Direct link to 3.4 parameter.txt 配置" title="Direct link to 3.4 parameter.txt 配置">​</a></h3>
<p>如果使用 Linux kernel 3.10 和 Linux kernel 4.4, 需要确保在 parameter.txt 文件中有以下对于控制台的指定命令:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CMDLINE: console=ttyFIQ0 androidboot.console=ttyFIQ0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4驱动调试">4.驱动调试<a href="#4驱动调试" class="hash-link" aria-label="Direct link to 4.驱动调试" title="Direct link to 4.驱动调试">​</a></h2>
<p>Rockchip UART 调试提供一个测试程序 ts_uart.uart､两个测试用文件 send_0x55 和 send_00_ff, 该程序可以向 Rockchip FAE 获取｡</p>
<p>通过 adb 工具将测试程序放在开发板上一个可执行的路径下，以下放在 data 路径:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">adb root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adb remount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adb push ts_uart.uart /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adb push send_0x55 /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">adb push send_00_ff /data</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在开发板上修改测试程序权限:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">su</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x /data/ts_uart.uart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用以下命令可以获取程序帮助:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">console:/ #./data/ts_uart.uart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Use the following format to run the HS-UART TEST PROGRAM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_uart v1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For sending data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./ts_uart &lt;tx_rx(s/r)&gt; &lt;file_name&gt; &lt;baudrate&gt; &lt;flow_control(0/1)&gt; &lt;max_delay(0-100)&gt; &lt;random_size(0/1)&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tx_rx : send data from file (s) or receive data (r) to put in file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">file_name : file name to send data from or place data in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baudrate : baud rate used for TX/RX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flow_control : enables (1) or disables (0) Hardware flow control using RTS/CTS lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_delay : defines delay in seconds between each data burst when sending. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Choose 0 for continuous stream.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">random_size : enables (1) or disables (0) random size data bursts when sending. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Choose 0 for max size.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_delay and random_size are useful for sleep/wakeup over UART testing. ONLY meaningful when sending data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Examples:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sending data (no delays)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_uart s init.rc 1500000 0 0 0 /dev/ttyS0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loop back mode:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_uart m init.rc 1500000 0 0 0 /dev/ttyS0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive, data must be 0x55</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_uart r init.rc 1500000 0 0 0 /dev/ttyS0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-测试发送">4.1 测试发送<a href="#41-测试发送" class="hash-link" aria-label="Direct link to 4.1 测试发送" title="Direct link to 4.1 测试发送">​</a></h3>
<p>测试发送的命令如下，send_0x55 和 send_00_ff 为发送的文件:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./data/ts_uart.uart s ./data/send_0x55 1500000 0 0 0 /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./data/ts_uart.uart s ./data/send_00_ff 1500000 0 0 0 /dev/ttyS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>发送成功可以通过 USB 转 UART 小板连接 PC 端，使用 PC 端串口调试工具验证｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-测试接收">4.2 测  试接收<a href="#42-测试接收" class="hash-link" aria-label="Direct link to 4.2 测试接收" title="Direct link to 4.2 测试接收">​</a></h3>
<p>测试接收的命令如下，receive_0x55 为接收的文件:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./data/ts_uart.uart r ./data/receive_0x55 1500000 0 0 0 /dev/ttyS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以使用 PC 端串口调试工具发送数据，测试程序将自动检测，检测到 U（0x55）接收正确，检测到其它字符将打印 16 进制 ASCII 码值，可以对照查询接收是否正确｡</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-测试内部自发自收">4.3 测试内部自发自收<a href="#43-测试内部自发自收" class="hash-link" aria-label="Direct link to 4.3 测试内部自发自收" title="Direct link to 4.3 测试内部自发自收">​</a></h3>
<p>测试内部自发自收的命令如下:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./data/ts_uart.uart m ./data/send_00_ff 1500000 0 0 0 /dev/ttyS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>按下 Ctrl+C 停止测试，可以观察到结束 log 如下｡比较发送和接收的数据是否一致:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sending data from file to port...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send:1172, receive:1172 total:1172 # 收发数据一致,测试成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send:3441, receive:3537 total:3441 # 收发数据不一致,测试失败</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果测试失败，说明当前串口存在问题或者有其他程序也在使用同一个串口｡可以使用以下命令查看哪些程序打开了这个串口:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lsof | grep ttyS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-测试流控">4.4 测试流控<a href="#44-测试流控" class="hash-link" aria-label="Direct link to 4.4 测试流控" title="Direct link to 4.4 测试流控">​</a></h3>
<p><strong>验证 CTS</strong>：先手动拉高 CTS 引脚电平，再使用以下命令发送数据:</p>
<div class="language-plaintext codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plaintext codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./data/ts_uart.uart s ./data/send_0x55 1500000 1 0 0 /dev/ttyS1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当 CTS 电平被拉高时，发送数据阻塞｡当释放 CTS 电平为低电平时，被阻塞的数据完成发送｡</p>
<p><strong>验证 RTS</strong>：通过测量 RTS 引脚电平是否能够正常拉高和拉低来确认｡</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/linuxboard-docs/tree/main/docs/Dshanpi-R1-Docs/part5/02-UartDrive.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/Dshanpi-R1-Docs/part5/SpiDrive"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SPI开发指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/Dshanpi-R1-Docs/part5/PwmDrive"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PWM开发指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1功能特点" class="table-of-contents__link toc-highlight">1.功能特点</a></li><li><a href="#2作为普通串口" class="table-of-contents__link toc-highlight">2.作为普通串口</a><ul><li><a href="#21-驱动路径" class="table-of-contents__link toc-highlight">2.1 驱动路径</a></li><li><a href="#22-menuconfig-配置" class="table-of-contents__link toc-highlight">2.2 menuconfig 配置</a></li><li><a href="#23-dts-配置" class="table-of-contents__link toc-highlight">2.3 dts 配置</a></li><li><a href="#24-波特率配置" class="table-of-contents__link toc-highlight">2.4 波特率配置</a></li><li><a href="#25-使用-dma" class="table-of-contents__link toc-highlight">2.5 使用 DMA</a></li><li><a href="#26-使用硬件自动流控" class="table-of-contents__link toc-highlight">2.6 使用硬件自动流控</a></li><li><a href="#27-使用串口唤醒系统" class="table-of-contents__link toc-highlight">2.7 使用串口唤醒系统</a></li><li><a href="#28-设备注册" class="table-of-contents__link toc-highlight">2.8 设备注册</a></li></ul></li><li><a href="#3作为控制台" class="table-of-contents__link toc-highlight">3.作为控制台</a><ul><li><a href="#31-驱动路径" class="table-of-contents__link toc-highlight">3.1 驱动路径</a></li><li><a href="#32-menuconfig-配置" class="table-of-contents__link toc-highlight">3.2 menuconfig 配置</a></li><li><a href="#33-dts-配置" class="table-of-contents__link toc-highlight">3.3 dts 配置</a></li><li><a href="#34-parametertxt-配置" class="table-of-contents__link toc-highlight">3.4 parameter.txt 配置</a></li></ul></li><li><a href="#4驱动调试" class="table-of-contents__link toc-highlight">4.驱动调试</a><ul><li><a href="#41-测试发送" class="table-of-contents__link toc-highlight">4.1 测试发送</a></li><li><a href="#42-测试接收" class="table-of-contents__link toc-highlight">4.2 测试接收</a></li><li><a href="#43-测试内部自发自收" class="table-of-contents__link toc-highlight">4.3 测试内部自发自收</a></li><li><a href="#44-测试流控" class="table-of-contents__link toc-highlight">4.4 测试流控</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>